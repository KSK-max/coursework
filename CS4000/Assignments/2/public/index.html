<!DOCTYPE html>
<html lang="en">
   <head>
      <title>ðŸŽ¥ film - a simple cloud app</title>
      <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
      <style>
         table, th, td {
         border: 1px solid black;
         border-collapse: collapse;
         }
         th, td {
         padding: 5px;
         text-align: left;
         }
      </style>
   </head>
   <body>
      <h2>ðŸŽ¥ film - a simple cloud app</h2>
      <!-- Vue app starts here --> 
      <div  id="app">
         <!-- Create and destroy buttons -->
         <button class="button" type="submit" v-on:click='createDB'>Create</button>
         <button class="button" type="submit" v-on:click='destroyDB'>Destroy</button>
         <!-- Input fields for query input -->
         <br>Enter the details (movie title, year):<br>
         <input type="text" v-model="title" v-on:keyup.enter="queryDB" placeholder="Title">
         <input type="text" v-model="year" v-on:keyup.enter="queryDB" placeholder="Year">
         <button class="button" type="submit" v-on:click='queryDB'>Query</button><br><br>
         <div>
            <!-- Table to display query -->
            <table id="movies">
               <tr>
                  <th>Title</th><th>Year</th><th>Rank</th><th>Release Date</th>
               </tr>
               <!-- generate table from queried response -->
               <tr v-for="query in results">
                  <td>{{query.title}}</td>
                  <td>{{query.year}}</td>
                  <td>{{query.info.rank}}</td>
                  <td>{{query.info.release_date.substring(0,10)}}</td>
               </tr>
            </table>
         </div>
      </div>
      <!-- Initialize Vue app-->
      <script>
         var app = new Vue({
             el: "#app",
             data: {
                 year: "",
                 title: "",
                 results: {},
             },
             methods: {
                 //function calls create API
                 createDB: function () {
                     let res = fetch("create/")
                 },
                 // this function sends query response to retrieve processed results
                 queryDB: function () {
                     let res = fetch("query/" + this.year + '/' + this.title)
                     res.then(response => response.json())
                     .then(response => {
                         console.log(response)
                         this.results = response.Items
                     });
                 },
                 //function calls destroy API
                 destroyDB: function () {
                     let res = fetch("destroy/")
                 },
             }
         })
      </script>
   </body>
</html>